@(currentSource: Page[models.facebook.FacebookComment], currentSortBy: String, currentOrder: String, currentFilter: String, postKey: String)

@import org.joda.time.DateTime
@import tags._

@link(newSource:Int, newSortBy:String, prefFirstOrder:String) = @{

	var sortBy = currentSortBy
	var order = currentOrder

	if(newSortBy != null) {
		sortBy = newSortBy
		if(currentSortBy == newSortBy) {
			if(currentOrder == "asc") {
				order = "desc"
			} else {
				order = "asc"
			}
		} else {
			order = prefFirstOrder
		}
	}

	// Generate the link
	routes.FacebookController.fbComments(newSource, sortBy, order, currentFilter, postKey)
}

@generateXmlFile = @{

	var ids = ""

	for(comment <- currentSource.getList) {
		ids += comment.getCommentKey + ","
	}

	routes.FacebookController.generateXlsFile(ids)
}

@actionButtons = {
	<a class="btn" id="add" href="@routes.FacebookController.index("")"><i class="icon-arrow-left"></i> Return to Posts</a>
	<a class="btn" id="add" href="@routes.FacebookController.fetchCommentsFromPostKey(postKey)"><i class="icon-arrow-down"></i> Fetch Comments</a>
}

@extraAttributes = {
	<input type="hidden" value="@postKey" name="key" />
}

@main(actionButtons) {

	@if(currentSource.getTotalRowCount == 0) {

		<div class="well">
			<em>Nothing to display</em>
		</div>

	} else {

		@searchBox(currentFilter, link(0, "message", "desc"), extraAttributes)

		<table class="table table-striped table-bordered table-condensed">
			<thead>
				<tr>
					@header("createdTime", "Date", currentSortBy, currentOrder, link(1, "createdTime", "desc"))
					@header("likeCount", "Like Count", currentSortBy, currentOrder, link(1, "likeCount", "desc"))
					@header("author.name", "Author Name", currentSortBy, currentOrder, link(1, "author.name", "asc"))
					@header("message", "Message", currentSortBy, currentOrder, link(1, "message", "desc"))
				</tr>
			</thead>
			<tbody>

				@for(comment <- currentSource.getList) {
					<tr>
						<td style="white-space: nowrap">
							@(new DateTime(comment.getCreatedTime).toString("HH:mm:ss dd/MM/yyyy"))
						</td>
						<td>
							@comment.getLikeCount
						</td>
						<td style="white-space: nowrap">
							<a title="Go to the user page on facebook" href="http://www.facebook.com/@comment.getAuthor.getProfileId" target="_blank">@comment.getAuthor.getName</a>
						</td>
						<td>
							@comment.getMessage
						</td>
					</tr>
				}
			</tbody>
		</table>

		@pagination(currentSource, link(1, null, ""), link(currentSource.getPageIndex - 1, null, ""), link(currentSource.getPageIndex + 1, null, ""), link(0, null, ""))
	}
}