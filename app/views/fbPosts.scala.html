@(currentPage: Page[FacebookPost], currentSortBy: String, currentOrder: String, currentFilter: String, currentSourceId: String, currentSourceName: String, profiles: List[FacebookProfile])

@import org.joda.time.DateTime
@import helper.twitterBootstrap._
@import tags._

@link(newSource:Int, newSortBy:String, newSourceName: String) = @{

	var sortBy = currentSortBy
	var order = currentOrder
	var sourceId = currentSourceId
	var sourceName = currentSourceName

	if(newSourceName != null) {
		sourceName = newSourceName
	}

	if(newSortBy != null) {
		sortBy = newSortBy
		order = "asc"
		if(currentSortBy == newSortBy) {
			if(currentOrder == "asc") {
				order = "desc"
			}
		}
	}

	routes.FacebookController.fbPosts(newSource, sortBy, order, currentFilter, sourceId, sourceName)
}

@actionButtons = {
	<form class="navbar-form" action="@routes.FacebookController.fetchPosts("", 0)">
		<input type="text" id="limit" name="limit" class="span1" pattern="[0-9]{1,4}" placeholder="Limit" required>
		<input type="text" id="pageName" name="pageName" class="span2" placeholder="Page name" required>
		<button type="submit" class="btn"><i class="icon-arrow-down"></i> Fetch Posts</a>
	</form>
}

@main(actionButtons) {

	<div class="pull-left">
		@searchBox(currentFilter, link(1, "createdTime", null))
	</div>

	<div class="pull-right">
		<div class="input-append dropdown combobox">
			<input class="span2" type="text" value="@if(currentSourceName == ""){Show all pages}else{@currentSourceName}"><button class="btn" data-toggle="dropdown"><i class="caret"></i></button>
			<ul class="dropdown-menu">
				<li><a href="@routes.FacebookController.fbPosts(1, currentSortBy, currentOrder, currentFilter, "", "")">Show all pages</a></li>
				@for(p <- profiles) {
					<li><a href="@routes.FacebookController.fbPosts(1, currentSortBy, currentOrder, currentFilter, p.getProfileId, p.getName)">@p.getType/@p.getName</a></li>
				}
			</ul>
		</div>
	</div>

	@if(currentPage.getTotalRowCount == 0) {

		<div class="well">
			<em>Nothing to display</em>
		</div>

	} else {

		<div class="clearfix">
			<table class="table table-striped table-bordered table-condensed">
				<thead>
					<tr>
						@header("createdTime", "Date", currentSortBy, currentOrder, link(1, "createdTime", null))
						@header("source.getName", "Source Name", currentSortBy, currentOrder, link(1, "source.getName", null))
						@header("message", "Message", currentSortBy, currentOrder, link(1, "message", null))
						@header("commentCount", "Comments", currentSortBy, currentOrder, link(1, "commentCount", null))
						@header("likeCount", "Likes", currentSortBy, currentOrder, link(1, "likeCount", null))
						@header("shareCount", "Shares", currentSortBy, currentOrder, link(1, "shareCount", null))
					</tr>
				</thead>
				<tbody>

					@for(post <- currentPage.getList) {
						<tr>
							<td style="white-space: nowrap">
								@(new DateTime(post.getCreatedTime).toString("HH:mm:ss dd/MM/yyyy"))
							</td>
							<td>@post.getSource.getName</td>
							<td><a href="@post.getLink" target="_blank">@post.getMessage</a></td>
							<td>
								<a href="@routes.FacebookController.fbComments(0,"createdTime","asc", "", post.getPostKey)" title="Open comments of this post">@post.getCommentCount</a>
							</td>
							<td>@post.getLikeCount</td>
							<td>@post.getShareCount</td>
						</tr>
					}
				</tbody>
			</table>
		</div>

		@pagination(currentPage, link(1, null, null), link(currentPage.getPageIndex - 1, null, null), link(currentPage.getPageIndex + 1, null, null), link(0, null, null))
	}
}